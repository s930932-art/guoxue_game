<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>國學分類小遊戲</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; background: #f4f4f4; }
    h1 { color: #333; }
    #game, #result { display: none; margin-top: 20px; }
    #question { font-size: 24px; margin: 20px; }
    .options { display: flex; justify-content: center; flex-wrap: wrap; margin: 20px; }
    .option {
      padding: 15px 20px;
      margin: 10px;
      border-radius: 10px;
      background: #fff;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      cursor: pointer;
      font-size: 20px;
      min-width: 100px;
      transition: 0.2s;
    }
    .option:hover { background: #dbeafe; }
    #scoreboard, #timer { font-size: 22px; margin: 10px; color: #444; }
    #timer { color: #b91c1c; }
    #startBtns button, #restartBtn {
      margin-top: 30px;
      padding: 10px 20px;
      font-size: 18px;
      border-radius: 10px;
      cursor: pointer;
      border: none;
      background: #4CAF50;
      color: white;
    }
    #restartBtn { background: #2196F3; }
    table { margin: 20px auto; border-collapse: collapse; width: 90%; }
    th, td { border: 1px solid #999; padding: 8px; font-size: 18px; }
    th { background-color: #eee; }
    #titleRecord { font-size: 20px; margin-top: 20px; }
  </style>
</head>
<body>
  <h1>國學分類小遊戲</h1>

  <!-- 模式選單 -->
  <div id="startBtns">
    <button onclick="selectMode('timed')">限時30秒挑戰</button>
    <button onclick="selectMode('challenge')">10題計時挑戰</button>
  </div>

  <!-- 遊戲區 -->
  <div id="game">
    <div id="timer"></div>
    <div id="scoreboard">分數：0</div>
    <div id="question">題目出現中...</div>
    <div class="options">
      <div class="option" data-choice="經">經</div>
      <div class="option" data-choice="史">史</div>
      <div class="option" data-choice="子">子</div>
      <div class="option" data-choice="集">集</div>
    </div>
  </div>

  <!-- 結果頁 -->
  <div id="result">
    <h2>遊戲結束！</h2>
    <p id="finalScoreBox">你的總分是：<span id="finalScore"></span></p>
    <p id="finalTime"></p>
    <p id="titleRecord"></p>
    <div id="recordTable"></div>
    <button id="restartBtn">重新開始</button>
  </div>

  <script>
    const game = document.getElementById("game");
    const result = document.getElementById("result");
    const questionEl = document.getElementById("question");
    const options = document.querySelectorAll(".option");
    const scoreEl = document.getElementById("scoreboard");
    const timerEl = document.getElementById("timer");
    const finalScoreEl = document.getElementById("finalScore");
    const finalTimeEl = document.getElementById("finalTime");
    const recordTableDiv = document.getElementById("recordTable");
    const titleRecord = document.getElementById("titleRecord");
    const restartBtn = document.getElementById("restartBtn");
    const startBtns = document.getElementById("startBtns");
    const finalScoreBox = document.getElementById("finalScoreBox");

    const questions = [
      { text: '《詩經》', answer: '經' }, { text: '《春秋》', answer: '經' },
      { text: '《禮記》', answer: '經' }, { text: '《孟子》', answer: '經' },
      { text: '《尚書》', answer: '經' }, { text: '《周禮》', answer: '經' },
      { text: '《易經》', answer: '經' }, { text: '《儀禮》', answer: '經' },
      { text: '《公羊傳》', answer: '經' }, { text: '《穀梁傳》', answer: '經' },
      { text: '《論語》', answer: '經' }, { text: '《孝經》', answer: '經' },
      { text: '《左傳》', answer: '經' }, { text: '《爾雅》', answer: '經' },
      { text: '《說文解字》', answer: '經' }, { text: '《史記》', answer: '史' },
      { text: '《漢書》', answer: '史' }, { text: '《資治通鑑》', answer: '史' },
      { text: '《後漢書》', answer: '史' }, { text: '《晉書》', answer: '史' },
      { text: '《孫子兵法》', answer: '子' }, { text: '《莊子》', answer: '子' },
      { text: '《韓非子》', answer: '子' }, { text: '《荀子》', answer: '子' },
      { text: '《墨子》', answer: '子' }, { text: '《淮南子》', answer: '子' },
      { text: '《山海經》', answer: '子' }, { text: '《世說新語》', answer: '子' },
      { text: '《楚辭》', answer: '集' }, { text: '《文選》', answer: '集' },
      { text: '《陶淵明集》', answer: '集' }, { text: '《唐詩三百首》', answer: '集' },
      { text: '《全唐詩》', answer: '集' }, { text: '《宋詞三百首》', answer: '集' },
      { text: '《元曲選》', answer: '集' }
    ];

    let availableQuestions = [];
    let currentQuestion = null;
    let score = 0;
    let wrongRecords = [];
    let mode = "timed";
    let timeLeft = 30;
    let usedTime = 0;
    let timer;

    function shuffle(array) { return array.sort(() => Math.random() - 0.5); }

    function getTitle(score) {
      if(score <= 5) return "書卷新生";
      if(score <= 10) return "學堂小秀才";
      if(score <= 15) return "經史大家";
      return "國學宗師";
    }

    function selectMode(selectedMode) {
      mode = selectedMode;
      startGame();
    }

    function startGame() {
      score = 0;
      wrongRecords = [];
      availableQuestions = shuffle([...questions]);
      scoreEl.textContent = `分數：${score}`;
      recordTableDiv.innerHTML = '';
      titleRecord.textContent = '';
      startBtns.style.display = "none";
      result.style.display = "none";
      game.style.display = "block";

      if (mode === "timed") {
        timeLeft = 30;
        timerEl.textContent = `剩餘時間：${timeLeft} 秒`;
        startTimer();
      } else {
        usedTime = 0;
        timerEl.textContent = `已用時間：${usedTime} 秒`;
        startStopwatch();
      }

      nextQuestion();
    }

    function nextQuestion() {
      if ((mode === "timed" && availableQuestions.length === 0) ||
          (mode === "challenge" && score >= 10)) {
        endGame();
        return;
      }
      currentQuestion = availableQuestions.pop();
      questionEl.textContent = `請問「${currentQuestion.text}」屬於哪一類？`;
    }

    function checkAnswer(choice) {
      if (!currentQuestion) return;
      if (choice === currentQuestion.answer) {
        score++;
        scoreEl.textContent = `分數：${score}`;
      } else {
        wrongRecords.push({ text: currentQuestion.text, your: choice, correct: currentQuestion.answer });
      }
      nextQuestion();
    }

    function startTimer() {
      clearInterval(timer);
      timer = setInterval(() => {
        timeLeft--;
        timerEl.textContent = `剩餘時間：${timeLeft} 秒`;
        if (timeLeft <= 0) {
          clearInterval(timer);
          endGame();
        }
      }, 1000);
    }

    function startStopwatch() {
      clearInterval(timer);
      timer = setInterval(() => {
        usedTime++;
        timerEl.textContent = `已用時間：${usedTime} 秒`;
      }, 1000);
    }

    function endGame() {
      clearInterval(timer);
      game.style.display = "none";
      result.style.display = "block";
      recordTableDiv.innerHTML = "";

      if (mode === "timed") {
        finalScoreBox.style.display = "block";
        finalScoreEl.textContent = score;
        finalTimeEl.textContent = "";
        titleRecord.textContent = `稱號：${getTitle(score)}`;
      } else {
        finalScoreBox.style.display = "none"; // 不顯示分數
        finalTimeEl.textContent = `總用時：${usedTime} 秒`;
        titleRecord.textContent = ""; // 不顯示稱號
      }

      if (wrongRecords.length > 0) {
        let table = `<table>
          <tr><th>題目</th><th>你的答案</th><th>正確答案</th></tr>`;
        wrongRecords.forEach(w => {
          table += `<tr><td>${w.text}</td><td>${w.your}</td><td>${w.correct}</td></tr>`;
        });
        table += `</table>`;
        recordTableDiv.innerHTML = table;
      }
    }

    options.forEach(opt => {
      opt.addEventListener("click", () => checkAnswer(opt.dataset.choice));
    });

    restartBtn.onclick = () => {
      startBtns.style.display = "block";
      result.style.display = "none";
    };
  </script>
</body>
</html>
